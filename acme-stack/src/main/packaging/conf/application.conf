########### Modules to start ###########
modules = [
  ########### Core ###########
  "server=io.knotx.server.KnotxServerVerticle"
  "fsRepo=io.knotx.repository.fs.FilesystemRepositoryConnectorVerticle"
  "splitter=io.knotx.splitter.FragmentSplitterVerticle"
  "assembler=io.knotx.assembler.FragmentAssemblerVerticle"
  "hbsKnot=io.knotx.knot.templating.HandlebarsKnotVerticle"
  "gatewayKnot=io.knotx.gateway.GatewayKnotVerticle"
  "respProviderKnot=io.knotx.gateway.ResponseProviderKnotVerticle"
  ########### Data Bridge ###########
  "dataBridge=io.knotx.databridge.core.DataBridgeKnot"
  "dataSourceHttp=io.knotx.databridge.http.HttpDataSourceAdapter"
  ########### Forms ###########
  "forms=io.knotx.forms.core.FormsKnot"
  ########### Custom ###########
  "customFormsAdapter=com.acme.forms.adapter.http.FormsAdapterVerticle"
  "reqProcessorKnot=com.acme.gateway.RequestProcessorKnotVerticle"
  "serviceMock=com.acme.content.MockServiceVerticle"
]

global {

  ########### Snippets ###########
  snippetOptions {
    # Knot.x snippet HTML tag name. Default is 'script'.
    # Change here if you want to use different tag name, e.g. 'knotx:snippet'
    tagName = "knotx:snippet"

    # This prefix will start every snippet parameter in the snippet tag.
    # You may set it to 'data-xxxx-' when snippet tag name is an HTML tag to keep HTML5 data naming
    # compliance, e.g. when you set it to 'data-knotx-', snippet params will look like:
    # <script data-knotx-knotx="someKnot, handlebars"
    #         data-knotx-someKnot-param-name="XYZ" >
    paramsPrefix = ""
  }


  ########### Modules ###########
  server {
    port = 8092
    routingSpecificationLocation = /conf/openapi.yaml
    routingOperations.handlers {
      request = [
        {
          name = cookieHandler
        },
#        {
#          # CSRF protection related global configuration
#          name = csrfHandler
#          config {
#            # A CSRF cookie name. Default is XSRF-TOKEN
#            # cookieName =
#
#            # CSRF Cookie path. Default is /
#            # cookiePath =
#
#            # Expected CSRF header name. Default is X-XSRF-TOKEN
#            #
#            # headerName =
#
#            # A secret used to initialize CSRF value generation.
#            # If not set a randomly generated 20 character long value will be used
#            #
#            secret = Knot.x is awsome
#
#            # THe CSRF token expiration time in milliseconds. Default is 30 minutes (1800000)
#            #
#            # timeout =
#          }
#        },
        {
          name = bodyHandler
        },
        {
          name = knotContextHandler
        }
      ],
      response = [
        {
          # Statically defined HTTP response header returned to the client in every HTTP response
          name = headerHandler
          config.name = X-Server
          config.value = Knot.x-Example
        },
        {
          name = writerHandler
          # List of HTTP response headers Knot.x can return to the client
          config.allowedResponseHeaders = [
            Access-Control-Allow-Origin
            Allow
            Cache-Control
            Content-Disposition
            Content-Encoding
            Content-Language
            Content-Location
            Content-MD5
            Content-Range
            Content-Type
            Content-Length
            Content-Security-Policy
            Date
            Edge-Control
            ETag
            Expires
            Last-Modified
            Location
            Pragma
            Proxy-Authenticate
            Server
            Set-Cookie
            Status
            Surrogate-Control
            Vary
            Via
            X-Frame-Options
            X-XSRF-TOKEN
            X-XSS-Protection
            X-Content-Type-Options
            X-UA-Compatible
            X-Request-ID
            X-Server
          ]
        }
      ]
    }
  }

  assembler.address = knotx.core.assembler
  splitter.address = knotx.core.splitter

  # Repositories
  repositories {
    httpRepo.address = knotx.core.repository.http
    fileSystemRepo.address = knotx.core.repository.filesystem
  }

  # Knot.x Forms with custom Http Adapter
  forms {
    address = knotx.knot.forms
    example.adapter.address = knotx.forms.adapter.http
  }

  # Data Bridge
  bridge {
    address = knotx.knot.databridge
    dataSource.defaultHttp.address = knotx.bridge.datasource.http
  }

  # Knot.x Template Engine with Handlebars Syntax
  hbs.address = knotx.knot.handlebars

  # Knot.x Gateway
  gateway {
    address = knotx.gateway.gatewayknot
    example.reqProcessor.address = knotx.gateway.requestprocessor
  }

  ############## SAMPLE ##############
  sample.httpService {
    domain = localhost
    port = 3000
  }

}

########### Core modules configurations ###########
config.server {
  options.config {
    include required("includes/server.conf")
  }
}

config.fsRepo {
  options.config {
    include required("includes/fsRepo.conf")
  }
}

config.splitter.options.config {
  address = ${global.splitter.address}
  snippetOptions = ${global.snippetOptions}
}

config.assembler.options.config {
  address = ${global.assembler.address}
  snippetOptions = ${global.snippetOptions}
}

config.hbsKnot {
  options.config.address = ${global.hbs.address}
  options.config.cacheSize = 1000
}

config.forms {
  options.config {
    include required("includes/forms.conf")
  }
}

########### Data Bridge modules configurations ###########

config.dataBridge {
  options.config {
    include required("includes/dataBridge.conf")
  }
}

config.dataSourceHttp {
  options.config {
    include required("includes/dataSourceHttp.conf")
  }
}

########### Custom modules configurations ###########

config.customFormsAdapter {
  options.config {
    include required("includes/custom/formsAdapter.conf")
  }
}

config.serviceMock.options.config {
  mockDataRoot = sample/service
  bouncing = true
  httpPort = ${global.sample.httpService.port}
}

config.reqProcessorKnot.options.config {
  address = ${global.gateway.example.reqProcessor.address}
}
